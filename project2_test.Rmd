---
title: "project2_test"
author: "Group_01"
date: "2021/7/7"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE, comment = NA)
```

```{r libraries}
library(tidyverse)
library(moderndive)
library(skimr)
library(kableExtra)
library(gridExtra)
library(broom)
library(plotly)
library(GGally)
library(sjPlot)
```

```{r data, echo = FALSE, eval = TRUE, warning = FALSE, message = FALSE}
data <- read.csv("dataset1.csv")
```

```{r data.score}
data.score <- data %>%
  dplyr::select(Total.Number.of.Family.members,Total.Household.Income,
                Total.Food.Expenditure, Household.Head.Age, House.Floor.Area, House.Age,
                Number.of.bedrooms, Electricity)
```

```{r}
data.score %>%
  cor()
```

```{r}
ggpairs(data.score, aes(colour = "blue", alpha = 0.4))
```


```{r summaries}
my_skim <- skim_with(numeric = sfl(hist = NULL))
my_skim(data.score)  %>%
  dplyr::select(-skim_type) %>%
  as_tibble() %>%
  kable(col.names = c("Variable", "Missing", "Complete", "Mean", "SD", "Min.", "1st Q.",
                      "Median", "3rd Q.", "Max."),
        caption = "Summary statistics",
        booktabs = TRUE,  digits = 2) %>%
  kable_styling(font_size = 10, latex_options = "hold_position") #create a summarized statistics table for the three variables
```

## Gender&age
```{r}
data.gender <- data %>%
  select(Household.Head.Sex, Household.Head.Age)
```

```{r}
ggplot(data = data.gender, aes(x = Household.Head.Sex, y = Household.Head.Age, fill = Household.Head.Sex)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Age")+ 
  theme(legend.position = "none")
```



## balance
```{r}
data.balance <- data %>%
  select(Total.Household.Income, Total.Food.Expenditure)
```

```{r}
ggplot(data = data.balance, aes(x = Total.Household.Income, y = Total.Food.Expenditure)) +
  geom_point() +
  labs(x = "Income", y = "Expenditure") +
  geom_smooth(method = glm, se = FALSE) +
  theme(legend.position = "none")
```


## Model

```{r}
model_full <- glm(Total.Number.of.Family.members ~ Total.Household.Income +
                Total.Food.Expenditure + Household.Head.Age + House.Floor.Area + House.Age +
                Number.of.bedrooms + Electricity, data = data)
```

```{r}
model_full %>%
  summary()
```

```{r}
model_significant <- glm(Total.Number.of.Family.members ~ Total.Household.Income +
                Total.Food.Expenditure + House.Age +
                Number.of.bedrooms, data = data)
```

```{r}
model_significant %>%
  summary()
```



## Family number & Gender
```{r}
data.sex_number <- data %>%
  select(Household.Head.Sex, Total.Number.of.Family.members)
```

```{r}
ggplot(data = data.sex_number, aes(x = Household.Head.Sex, y = Total.Number.of.Family.members, fill = Household.Head.Sex)) +
  geom_boxplot() +
  labs(x = "Gender", y = "Number of Family member")+ 
  theme(legend.position = "none")
```

## Log-odds
```{r}
data.sex_number$Household.Head.Sex <- as.factor(data.sex_number$Household.Head.Sex)
```

```{r}
model_sex_number <- glm(Household.Head.Sex ~ Total.Number.of.Family.members, data = data.sex_number,
                        family = binomial(link = "logit"))
```

```{r}
model_sex_number %>%
  summary()
```

```{r}
levels(data.sex_number$Household.Head.Sex)
```

```{r}
modelcoefs <- round(coef(model_sex_number),2)
```



\begin{align} \ln\left(\frac{p}{1-p}\right) &= \alpha + \beta \cdot \textrm{number of family members} = `r modelcoefs[1]` + `r modelcoefs[2]` \cdot 
\textrm{number of family members}, \nonumber \end{align}

Where $p = Prob(Male)$ and $1-p = Prob(Female)$.
Hence, the log-odds of the household being male increase by 0.18 for every one unit increase in number of family members. This provides us with a point estimate of how the log-odds changes with age. 

However, we are also interested in producing a 95% confidence interval for these log-odds.

```{r}
confint(model_sex_number) %>%
  kable()
```

```{r}
plot_model(model_sex_number, show.values = TRUE, transform = NULL,
           title = "Log-Odds (Male household)", show.p = FALSE)
```

Now, let's add the estimates of the log-odds to our data set:

```{r}
data.sex_number <- data.sex_number %>%
  mutate(logodds.male = predict(model_sex_number))
```

## Odds

```{r}
plot_model(model_sex_number, show.values = TRUE, axis.lim = c(1,1.5),
           title = "Odds (Male household)", show.p = FALSE)
```


Now, let's add the estimates of the odds to our data set:

```{r}
data.sex_number <- data.sex_number %>%
  mutate(odds.male = exp(logodds.male))
```


## Probabilities

```{r}
data.sex_number <- data.sex_number %>%
  mutate(probs.male = fitted(model_sex_number))
```


## Plot the probability of being male

```{r}
ggplot(data = data.sex_number, aes(x = Total.Number.of.Family.members, y = probs.male)) +
  geom_smooth(method="glm", 
              method.args = list(family="binomial"), 
              se = FALSE) +
  labs(x = "number of family members", y = "Probability of household being male")
```

```{r}
plot_model(model_sex_number, type = "pred", title = "",
            axis.title = c("number of family members", "Prob. of household being male"))
```













